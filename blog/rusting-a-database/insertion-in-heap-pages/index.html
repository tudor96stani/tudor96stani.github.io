<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8"><meta http-equiv="Content-Security-Policy"
content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com giscus.app;connect-src 'self' tudor96stani.goatcounter.com/count;script-src 'self' gc.zgo.at  giscus.app 'self'">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://tudor96stani.com">

    
    <title>
Notes on software • insertion in heap pages</title>

    
    
        <link rel="icon" type="image/png" href="https://tudor96stani.com/img/favicon-32x32.png"/>
    
    

    
    
        
            
            
                
                    <link rel="alternate" type="application/atom+xml" title="Notes on software - Atom Feed" href="https://tudor96stani.com/atom.xml">
                
            
        
    

    
    
    
        
            <link rel="stylesheet" href="https://tudor96stani.com/custom_subset.css?h=0b9535a28bc3d5bf2321">
        
    

    
        <link rel="stylesheet" href="https://tudor96stani.com/main.css?h=3716ab3457d2dd050b3c" />

    <meta name="color-scheme" content="light dark" />
        <meta name="description" content="Implementation of the insertion algorithm for unsorted heap pages" />
        <meta property="og:description" content="Implementation of the insertion algorithm for unsorted heap pages" />

    

    <meta property="og:title" content="insertion in heap pages" />
    <meta property="og:type" content="article" />

    
<meta property="og:locale" content="en_GB" />

    <meta property="og:url" content="https:&#x2F;&#x2F;tudor96stani.com&#x2F;blog&#x2F;rusting-a-database&#x2F;insertion-in-heap-pages&#x2F;" /><meta property="og:site_name" content="Notes on software">
        <noscript><link rel="stylesheet" href="https://tudor96stani.com/no_js.css"/></noscript>
        <script type="text/javascript" src="https://tudor96stani.com/js/initializeTheme.min.js"></script>
        <script defer src="https://tudor96stani.com/js/themeSwitcher.min.js"></script>




    
    
    <script async
    
        data-goatcounter="https://tudor96stani.goatcounter.com/count"
        src="https://gc.zgo.at/count.js"
        
    ></script>
    



        <script defer src="https://tudor96stani.com/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e"></script>

        
    
</head>


<body>
    <a href="#main-content" id="skip-link">Skip to content</a>
    <header>
    <nav class="navbar">
        <div class="nav-title">
            <a class="home-title" href="https://tudor96stani.com/">Notes on software</a>
        </div>
            <div class="nav-navs">
                <ul>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://tudor96stani.com/blog/">blog
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://tudor96stani.com/about/">about
                                </a>
                            </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding" href="https://tudor96stani.com/atom.xml">rss
                                </a>
                            </li>
                        <li class="menu-icons-container">
                        <ul class="menu-icons-group">
                            <li class="js menu-icon">
                                <div role="button" tabindex="0" id="search-button" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" aria-label="Click or press $SHORTCUT to open search">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                                        <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                                    </svg>
                                </div>
                            </li>

                            
                            

                            <li class="theme-switcher-wrapper js"><div
        title="Toggle dark&#x2F;light mode"
        class="theme-switcher"
        tabindex="0"
        role="button"
        aria-label="Toggle dark mode"
        aria-pressed="false">
    </div><div
        title="Reset mode to default"
        class="theme-resetter arrow"
        tabindex="0"
        role="button"
        aria-hidden="true"
        aria-label="Reset mode to default">
    </div>

</li>
</ul>
                    </li>
                </ul>
            </div>
        
    </nav>
</header>

    <div class="content" id="main-content">

        
        





<main>
    <article class="h-entry">
        <h1 class="p-name article-title">
            insertion in heap pages
        </h1>
        <a class="u-url u-uid" href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/"></a>

        <ul class="meta"><li>By <span class="p-author">Tudor Stanila</span></li><span class="hidden p-author h-card">
<a rel="author" href="https:&#x2F;&#x2F;tudor96stani.com" class="u-url " title="Tudor Stanila">Tudor Stanila</a>
</span>
<li><time class="dt-published" datetime="2026-01-19"><span class='separator' aria-hidden='true'>•</span>19th Jan 2026</time></li><li title="1131 words"><span class='separator' aria-hidden='true'>•</span>6 min read</li>
        </ul>
            

<div class="toc-container">
    
        <h3>Table of Contents</h3>
    

    <ul>
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#intro">Intro</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#high-level">High level</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#planning-phase">Planning phase</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#slot-number">Slot number</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#physical-location">Physical location</a>
                                        
                                            <ul>
                                                
                                                    
                                                        <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#notes">Notes</a>
                                                            
                                                        </li>
                                                    
                                                
                                            </ul>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#implementation">Implementation</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#insertion-phase">Insertion phase</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#reasoning">Reasoning</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#possible-improvements">Possible improvements</a>
                    
                </li>
            
        
    </ul>
</div>


        
            <p class="p-summary" hidden>Implementation of the insertion algorithm for unsorted heap pages</p><section class="e-content body">
    
<h2 id="intro">Intro</h2>
<p>Insertion in heap pages is, in theory, straightforward: you find some free space in the page, place the row there and create a slot pointing to that location. There are, however, multiple small details that make things a bit more complicated (mostly edge cases caused by fragmentation).</p>
<p>The implementation in TRDB is very similar to the one in Java - I mostly covered some scenarios I had missed there &amp; cleaned it up a bit, making it more granular and easier to test.</p>
<p>I will mostly cover the overall logic and reasoning behind it, limitations &amp; possible improvements.</p>
<h2 id="high-level">High level</h2>
<p>From a high level, the insertion is done in two separate steps:</p>
<ul>
<li>plan the insertion</li>
<li>perform the actual insertion</li>
</ul>
<p>The planning phase looks for a location for the new row, along with metadata for the insertion algorithm. <strong>No data is changed during this phase, it is a read-only operation.</strong></p>
<p>The insertion phase uses the metadata provided in the plan to actually place the row at the target position and to update the header &amp; slot array</p>
<h2 id="planning-phase">Planning phase</h2>
<p>This phase attempts to answer several questions about where the row is going to end up and what other changes are needed to the page from a maintenance point of view:</p>
<ul>
<li>what slot number will the row use?</li>
<li>where is it going to be physically placed?</li>
<li>is compaction needed for this insert?</li>
</ul>
<h3 id="slot-number">Slot number</h3>
<p>The first step of the planning is to go through the slot array and look for any unused slots. As a reminder: when a record is deleted its slot is only being invalidated, but kept in the array. The insertion algorithm will reuse these empty slots, to avoid increasing the footprint of the slot array unnecessarily.</p>
<p>The scan starts from the beginning of the array (rightmost element) and stops at the first unused slot it encounters. If no such slot is found, it flags that a new one will be needed.</p>
<h3 id="physical-location">Physical location</h3>
<p>In the second step of the planning, we look for a place to physically place the row itself in the page.</p>
<p>This is done by checking the following conditions, in this order:</p>
<ol>
<li>Can the row fit in the free space? (<code>free_end - free_start</code>)</li>
<li>Can the row fit between two existing rows?</li>
<li>Can the row fit between the last row and <code>free_start</code>?</li>
</ol>
<p>The options are probed one by one, halting at the first positive answer. If none are successful, the algorithm flags that a compaction is needed for this insertion.</p>
<h4 id="notes">Notes</h4>
<ul>
<li>Prior to this phase, an additional check is done to ensure that the row can physically fit in the page - meaning that there are enough free bytes in the page, regardless of fragmentation; if there are not, the entire flow is aborted. This allows us to have the fallback of compaction (we can be sure that if we could not find a large enough spot right now, there will be one once we compact)</li>
<li>All checks are done with the information from the first phase in mind - if a new slot is needed, 4 extra bytes are taken into account when determining the necessary overall space in the page.</li>
</ul>
<h3 id="implementation">Implementation</h3>
<p>The actual result of the planning phase is represented as an enum comprised of two other enums <a href="https://github.com/tudor96stani/trdb/blob/main/crates/storage/page/src/insertion_plan.rs">(code)</a>:</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Defines the offset at which a new record should be inserted in an unsorted heap page.  
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>  
</span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-enum z-rust">enum</span> <span class="z-entity z-name z-enum z-rust">InsertionOffset</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Record should be inserted at the start of free space after compacting the page.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    AfterCompactionFreeStart<span class="z-punctuation z-separator z-rust">,</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Record should be inserted at an exact offset.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    Exact<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-storage z-type z-rust">usize</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>  
</span><span class="z-source z-rust">  
</span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Defines whether a new slot should be created for the record or an existing slot can be reused when inserting into an unsorted heap page.  
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>  
</span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-enum z-rust">enum</span> <span class="z-entity z-name z-enum z-rust">InsertionSlot</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> A new slot should be created for the record.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    New<span class="z-punctuation z-separator z-rust">,</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> An existing slot can be reused for the record.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust">    Reuse<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-storage z-type z-rust">usize</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-separator z-rust">,</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-enum z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>  
</span><span class="z-source z-rust">  
</span><span class="z-source z-rust"><span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> Represents a plan for inserting a new record into an unsorted heap page.  
</span></span><span class="z-source z-rust"><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">derive</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust">Debug</span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>  
</span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-storage z-modifier z-rust">pub</span> <span class="z-storage z-type z-struct z-rust">struct</span> </span><span class="z-meta z-struct z-rust"><span class="z-entity z-name z-struct z-rust">InsertionPlan</span> </span><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The slot information for the insertion.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">slot</span><span class="z-punctuation z-separator z-type z-rust">:</span> InsertionSlot,  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-comment z-line z-documentation z-rust"><span class="z-punctuation z-definition z-comment z-rust">///</span> The offset information for the insertion.  
</span></span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust">    <span class="z-storage z-modifier z-rust">pub</span> <span class="z-variable z-other z-member z-rust">offset</span><span class="z-punctuation z-separator z-type z-rust">:</span> InsertionOffset,  
</span></span></span><span class="z-source z-rust"><span class="z-meta z-struct z-rust"><span class="z-meta z-block z-rust"></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<h2 id="insertion-phase">Insertion phase</h2>
<p>This is pretty straight forward: based on the insertion plan received from the previous step, it will know exactly whether it needs to compact the page beforehand, at what offset to place the row and how to handle the slot.</p>
<p>Besides inserting the actual row data and updating the slot array, the following header values are also updated:</p>
<ul>
<li><code>SLOT_COUNT</code> - incremented by 1 only if we are creating a new slot</li>
<li><code>FREE_END</code> - decremented by <code>SLOT_SIZE</code> only if we are creating a new slot</li>
<li><code>FREE_START</code> - incremented by <code>row.size</code> only if we are inserting at this location (meaning we are not using a gap between two rows)</li>
<li><code>FREE_SPACE</code> - always updated. Decremented by <code>row.size</code> if we are reusing a slot, or by <code>row.size + SLOT_SIZE</code> if we are also creating a new slot.</li>
</ul>
<h2 id="reasoning">Reasoning</h2>
<p>The initial implementation in Java was a single step insert - it worked ok, despite it becoming a bit too bloated. However, I had to split it into these two phase once I started working on write-ahead logging (WAL).</p>
<p>As the name suggests, in WAL you need to create a log entry with the operation that is <strong>going to</strong> happen, meaning you need to have all the information about the change you are about to make <strong>before</strong> you perform the change. This was problematic because one of the fields that had to be included in the log entry was the slot number of the row being inserted - value which was only known during/after the insertion, not before.</p>
<p>Since it is not acceptable to write an incomplete WAL entry and update it afterward, the only choice was to extract the logic that determined the physical location of the row outside the actual insertion, allowing me to (1) generate the insertion plan, (2) log the operation and (3) perform the actual insert.</p>
<p>I could have, of course, updated the insert method to perform the log internally, right before it placed the row in the page. However, I preferred to have the <code>Page</code> implementation unaware of the WAL and not couple the two in this manner.</p>
<h2 id="possible-improvements">Possible improvements</h2>
<p>During the search for a physical location in the planning phase, because the checks being performed are short-circuiting, their order is relevant and up for debate:</p>
<ul>
<li>on one hand the current implementation favors fragmentation, because it will only attempt to fill in gaps if the <code>free_end - free_start</code> area is not large enough.  However, it avoids scanning the existing slots if it is not necessary, thus providing a quicker response.</li>
<li>on the other hand, switching those two would reduce overall fragmentation, but would also incur useless scans of the slot array for scenarios where the fragmentation is low (which is also kept low by this algorithm)</li>
<li>don't think there is a right or wrong, although implementing them both and doing some benchmarking would be the only way of telling for sure
<ul>
<li>it is also highly influenced by access patterns: tables with low deletions would benefit from the current implementation, while tables with lots of inserts &amp; deletes could benefit from the second one</li>
</ul>
</li>
</ul>
<p>Another area of improvement is also during the planning phase: as of right now, the two steps in the planning phase scan over the slot array twice: once for the slot # and once for the physical location. It can be done in a single pass, but for now I chose clarity and testability over efficiency. Again, only some benchmarks could give us a performance penalty for this implementation.</p>

    

        </section>
                
                
                    
                        
                        
                        
                    
                    
                        
                        
                        
                    
                
                
            <nav class="full-width article-navigation">
                <div><a href="https://tudor96stani.com/blog/rusting-a-database/maintaining-stable-row-identifiers-during-page-maintenance/" aria-label="Prev" aria-describedby="left_title"><span class="arrow">←</span>&nbsp;Prev</a>
                <p aria-hidden="true" id="left_title">maintaining stable row identifiers during page maintenance</p></div>
                <div><a href="https://tudor96stani.com/blog/rusting-a-database/storage-manager-the-buffer/" aria-label="Next" aria-describedby="right_title">Next&nbsp;<span class="arrow">→</span></a>
                <p aria-hidden="true" id="right_title">Storage manager - the buffer</p></div>
            </nav>
        
        

        
            
            
            

            
                
                
            
        
            
            
            

            
        
            
            
            

            
        
            
            
            

            
        
        
            

<div id="comments" class="comments"


    data-repo="tudor96stani&#x2F;tudor96stani.github.io"
    data-repo-id="R_kgDOQuOQtQ"
    data-category="General"
    data-category-id="DIC_kwDOQuOQtc4C0MyW"
    
        data-mapping="pathname"
    
    data-strict="0"
    data-reactions-enabled="1"
    
        data-input-position="top"
    
    data-light-theme="noborder_light"
    data-dark-theme="noborder_dark"
    
        data-lang="en"
    
    data-lazy-loading="true"
    >




    <script src="https://tudor96stani.com/js/giscus.min.js" async></script>


<noscript>You need JavaScript to view the comments.</noscript>
</div>

        </article>
</main>

    <div id="button-container">
        
        
            <div id="toc-floating-container">
                <input type="checkbox" id="toc-toggle" class="toggle"/>
                <label for="toc-toggle" class="overlay"></label>
                <label for="toc-toggle" id="toc-button" class="button" title="Toggle Table of Contents">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M414.82-193.094q-18.044 0-30.497-12.32-12.453-12.319-12.453-30.036t12.453-30.086q12.453-12.37 30.497-12.37h392.767q17.237 0 29.927 12.487 12.69 12.486 12.69 30.203 0 17.716-12.69 29.919t-29.927 12.203H414.82Zm0-244.833q-18.044 0-30.497-12.487Q371.87-462.9 371.87-480.45t12.453-29.92q12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.511 12.69 12.512 12.69 29.845 0 17.716-12.69 30.086-12.69 12.37-29.927 12.37H414.82Zm0-245.167q-18.044 0-30.497-12.32t-12.453-30.037q0-17.716 12.453-30.086 12.453-12.369 30.497-12.369h392.767q17.237 0 29.927 12.486 12.69 12.487 12.69 30.203 0 17.717-12.69 29.92-12.69 12.203-29.927 12.203H414.82ZM189.379-156.681q-32.652 0-55.878-22.829t-23.226-55.731q0-32.549 23.15-55.647 23.151-23.097 55.95-23.097 32.799 0 55.313 23.484 22.515 23.484 22.515 56.246 0 32.212-22.861 54.893-22.861 22.681-54.963 22.681Zm0-245.167q-32.652 0-55.878-23.134-23.226-23.135-23.226-55.623 0-32.487 23.467-55.517t56.12-23.03q32.102 0 54.721 23.288 22.62 23.288 22.62 55.775 0 32.488-22.861 55.364-22.861 22.877-54.963 22.877Zm-.82-244.833q-32.224 0-55.254-23.288-23.03-23.289-23.03-55.623 0-32.333 23.271-55.364 23.272-23.03 55.495-23.03 32.224 0 55.193 23.288 22.969 23.289 22.969 55.622 0 32.334-23.21 55.364-23.21 23.031-55.434 23.031Z"/></svg>
                </label>
                <div class="toc-content">
                    

<div class="toc-container">
    

    <ul>
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#intro">Intro</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#high-level">High level</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#planning-phase">Planning phase</a>
                    
                        <ul>
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#slot-number">Slot number</a>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#physical-location">Physical location</a>
                                        
                                            <ul>
                                                
                                                    
                                                        <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#notes">Notes</a>
                                                            
                                                        </li>
                                                    
                                                
                                            </ul>
                                        
                                    </li>
                                
                            
                                
                                    <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#implementation">Implementation</a>
                                        
                                    </li>
                                
                            
                        </ul>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#insertion-phase">Insertion phase</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#reasoning">Reasoning</a>
                    
                </li>
            
        
            
            
                <li><a href="https://tudor96stani.com/blog/rusting-a-database/insertion-in-heap-pages/#possible-improvements">Possible improvements</a>
                    
                </li>
            
        
    </ul>
</div>


                </div>
            </div>
        

        
        <a href="#comments" id="comments-button" class="no-hover-padding" title="Go to the comments section">
                <svg viewBox="0 0 20 20" fill="currentColor"><path d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" fill-rule="evenodd"/></svg>
            </a>
        

        
        <a href="#" id="top-button" class="no-hover-padding" title="Go to the top of the page">
            <svg viewBox="0 0 20 20" fill="currentColor"><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg>
        </a>
    </div>


<span id="copy-success" class="hidden">
        Copied!
    </span>
    <span id="copy-init" class="hidden">
        Copy code to clipboard
    </span>
    <script defer src="https://tudor96stani.com/js/copyCodeToClipboard.min.js"></script>


    </div>
    <footer>
    <section>
        <nav class="socials nav-navs"><ul><li>
                        <a class="nav-links no-hover-padding social" rel="" 

 href="https://tudor96stani.com/atom.xml">
                        <img loading="lazy" alt="feed" title="feed" src="https://tudor96stani.com/social_icons/rss.svg">
                        </a>
                    </li><li class="js"><a class="nav-links no-hover-padding social" href="#" data-encoded-email="Y29udGFjdEB0dWRvcjk2c3RhbmkuY29t"><img loading="lazy" alt="email" title="email" src="https://tudor96stani.com/social_icons/email.svg">
                            </a>
                        </li>
                        
                            <li>
                                <a class="nav-links no-hover-padding social" rel=" me" 

 href="https://github.com/tudor96stani">
                                    <img loading="lazy" alt="github" title="github" src="https://tudor96stani.com/social_icons/github.svg">
                                </a>
                            </li>
                        
                    
                </ul>
            
        </nav>

        
        <nav class="nav-navs">
        </nav>

        <div class="credits">
            <small>
                

                
                Powered by
                <a rel="" 

 href="https://www.getzola.org">Zola</a>
                &amp;
                <a rel="" 

 href="https://github.com/welpo/tabi">tabi</a>

                •
                    <a rel="" 

 href="https:&#x2F;&#x2F;github.com&#x2F;tudor96stani&#x2F;trdb-blog">
                        Site source
                    </a></small>
        </div>
    </section>

    <script src="https://tudor96stani.com/js/decodeMail.min.js" async></script><div id="searchModal" class="search-modal js" role="dialog" aria-labelledby="modalTitle">
    <h1 id="modalTitle" class="visually-hidden">Search</h1>
    <div id="modal-content">
        <div id="searchBar">
            <div class="search-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                    <path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/>
                </svg>
            </div>
            <input id="searchInput" role="combobox" autocomplete="off" spellcheck="false" aria-expanded="false" aria-controls="results-container" placeholder="Search…"/>
            <div id="clear-search" class="close-icon interactive-icon" tabindex="0" role="button" title="Clear search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </div>
        </div>
        <div id="results-container">
            <div id="results-info"><span id="zero_results"> No results</span>
                <span id="one_results"> $NUMBER result</span>
                <span id="many_results"> $NUMBER results</span><span id="two_results"> $NUMBER results</span>
                <span id="few_results"> $NUMBER results</span>
            </div>
            <div id="results" role="listbox"></div>
        </div>
    </div>
</div>
</footer>


    
    
</body>

</html>
